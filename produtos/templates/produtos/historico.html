{% extends 'produtos/base.html' %} {% load humanize %} {% block title%}
Histórico - ItemShop{% endblock %} {% block content %}
<div class="container py-5">
  <h2 class="mb-4 fw-bold">
    <i class="fas fa-history me-2"></i>Histórico de Atividades
  </h2>

  <div class="row g-4">
    <!-- Extrato Financeiro -->
    <div class="col-lg-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white fw-bold py-3">
          <i class="fas fa-file-invoice-dollar me-2 text-success"></i>Extrato
          Financeiro
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Data</th>
                  <th>Descrição</th>
                  <th class="text-end">Valor</th>
                </tr>
              </thead>
              <tbody>
                {% for t in transacoes %}
                <tr>
                  <td><small>{{ t.data|date:"d/m H:i" }}</small></td>
                  <td>{{ t.descricao }}</td>
                  <td
                    class="text-end fw-bold {% if t.tipo == 'entrada' %}text-success{% else %}text-danger{% endif %}"
                  >
                    {% if t.tipo == 'entrada' %}+{% else %}-{% endif %} R$ {{
                    t.valor|intcomma }}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="3" class="text-center text-muted py-3">
                    Nenhuma transação encontrada.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Histórico de Pedidos -->
    <div class="col-lg-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white fw-bold py-3">
          <i class="fas fa-shopping-bag me-2 text-primary"></i>Meus Pedidos
        </div>
        <div class="list-group list-group-flush">
          {% for p in pedidos %}
          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
              <h6 class="mb-1 fw-bold">Pedido #{{ p.id }}</h6>
              <small class="text-muted">{{ p.data_pedido|date:"d/m/Y" }}</small>
            </div>
            <p class="mb-1 small">
              {% for item in p.itens.all %} {{ item.produto.nome }} (R$ {{
              item.preco_na_compra|intcomma }})<br />
              {% endfor %}
            </p>
            <small class="fw-bold text-primary"
              >Total: R$ {{ p.valor_total|intcomma }}</small
            >
          </div>
          {% empty %}
          <div class="text-center text-muted py-4">
            Você ainda não fez compras.
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
